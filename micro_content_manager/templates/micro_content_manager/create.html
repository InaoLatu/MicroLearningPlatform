{% load static %}
<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css">
    <link rel="stylesheet" type="text/css" href="{% static 'sky-forms.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'demo2.css' %}">
    <link rel="icon" type="image/png" href="{% static 'images/icons/book.png' %}"/>

    <title>Create Micro Content</title>
</head>
<body class="bg-study">

    <script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script>
         $(document).ready(function() {    //llamamos la a funcion ready() porque vamos a hacer referencia a etiquetas que estan declaradas posteriormente en el documento
                    document.getElementById("addQuestion").addEventListener("click", addQuestion, false);

                    var del = document.querySelectorAll(".delete-box");
                      for (var i=0;i<del.length;i++) {
                          del[i].addEventListener("click",deleteQuestion, false);
                      }
         });

         function deleteQuestion(num) {

              var id = num.target.id;
              id = id.toString();
              i =  id[7];         /*Getting the number of the question*/
              $("#q"+i).replaceWith("<span> </span>");
         }

         function addQuestion() {
                     $("#addQuestion-container h5").removeClass("animated bounce");
                     $("#addQuestion-container h5").addClass("animated bounce");
                     $("#idQuestions").attr('value',  parseInt($("#idQuestions").val()) + 1);

                    var id = $("#idQuestions").val();

                    $("#questions-container").append("<div class=\"quest\"  id=\"q"+$("#idQuestions").val()+"\" style=\"order: "+$("#idQuestions").val()+";\">");



                     $("#q"+id).append("<section>\n" +
                         "                                        <label><strong>Position in the Quiz: </strong>\n" +
                         "                                            <select name=\"order"+$("#idQuestions").val()+"\" id=\"order"+$("#idQuestions").val()+"\" onchange=\"applyPosition("+$("#idQuestions").val()+")\">\n" +
                         "                                                 <option value=1 selected>1</option>\n" +
                         "                                                 <option value=2>2</option>\n" +
                         "                                                 <option value=3>3</option>\n" +
                         "                                                 <option value=4>4</option>\n" +
                         "                                                 <option value=5>5</option>\n" +
                         "                                                 <option value=6>6</option>\n" +
                         "                                                 <option value=7>7</option>\n" +
                         "                                                 <option value=8>8</option>\n" +
                         "                                                 <option value=9>9</option>\n" +
                         "                                                 <option value=10 selected>10</option>\n" +
                         "                                            </select>\n" +
                         "                                        </label>\n" +
                         "                                    </section>");
                     $("#q"+id).append("<p>Question "+$("#idQuestions").val()+": <textarea name=\"question"+$("#idQuestions").val()+"\" rows=\"1\"\n" +
                         "                                                             cols=\"80\"></textarea><span id=\"deleteq"+$("#idQuestions").val()+"\" class=\"button red delete-box\">Delete question</span></p></p>");
                     $("#q"+id).append("<p>Choices "+$("#idQuestions").val()+" (write the possible answers and select the correct one):</p>\n");
                     $("#q"+id).append("  {% for c in choices %}\n"+
                         "                    <p>\n"+
                         "                        <input class=\"choice\"  type=\"radio\" name=\"answer"+$("#idQuestions").val()+"\"\n"
                         +
                         "                               value=\"choice"+$("#idQuestions").val()+"_{{ forloop.counter }}\"\n"
                         +
                         "                               {% if forloop.counter == 1 %}checked {% endif %}>\n"+
                         "                        <input type=\"text\" name=\"choice"+$("#idQuestions").val()+"_{{ forloop.counter }}\">\n"
                         +
                         "                    </p>\n"+
                         "                {% endfor %}<br>");


                        $("#q"+id).append("<p>Explanation "+$("#idQuestions").val()+": <textarea name=\"explanation"+$("#idQuestions").val()+"\" rows=\"1\"\n" +
                                 "                                                                cols=\"100\"></textarea></p></div><br><br>");
                     document.getElementById("deleteq"+id).addEventListener("click", deleteQuestion, false);
            }

         function applyURL(numberVideo) {
                var upload = document.getElementById("video_upload_form"+numberVideo).value
         }

         function applyPosition(numberQuestion) {
                order = document.getElementById("order"+numberQuestion).value;
                $("#q"+numberQuestion).css("order", order);
        }


        function get_name_from_file(id){
             //alert("yes");
             alert(document.getElementById("VideoFile"+id.toString()).value.toString());
             alert("no");
             document.getElementById("url_file"+id).value = document.getElementById("VideoFile" + id).value;
        }




       </script>


    <div class="body">
        <h1>Micro-learning content generator</h1>
      <form action="{% url 'micro_content_manager:store' nQuestions %}" method="post" class="sky-form" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="white">
            <header>
                <h2>Micro-content <a id="" class="button" href="{% url 'micro_content_manager:menu' %}" style="margin-right: 300px!important; font-size: 20px">Home</a></h2>
            </header>
                <fieldset>
                    <section><p><label for="title">Unit: <input type="text" placeholder="Unit" name="unit"></label></p></section>
                    <section><p><label for="title">Title: <input type="text" placeholder="Title" name="title"></label></p></section>
                    <section><p>Tags: <input type="text" name="mc_tags">
                     (Tags must be inserted separated by blank spaces (e.g., Tag1 Tag2 Tag3))</p></section>
                    {% for p in paragraphs %}
                        <section><p>Paragraph {{ forloop.counter }}:&nbsp;<textarea name="paragraph{{ forloop.counter }}" rows="1" cols="100"></textarea></p></section>
                    {% endfor %}
                </fieldset>
                <fieldset>
                    <h2>Videos</h2>
                    {% for v in videos %}
                        <section><h4>Video {{ forloop.counter }}</h4></section>
                        <section>Name: <input type="text" name="videoName{{ forloop.counter }}"></section>
                        <section>
                            <p>Upload form:
                                <select name="video_upload_form{{ forloop.counter }}" id="video_upload_form{{ forloop }}" onchange="applyURL({{ forloop.counter }})">
                                    <option value="from_existing_file" selected>From existing file</option>
                                    <option value="link_from_youtube">Link from YouTube</option>
                                </select>
                            </p>
                        </section>
                        <section><input name="videoFile{{ forloop.counter }}" id="videoFile{{ forloop.counter }}" type="file" accept="video/*" onchange="get_name_from_file({{ forloop.counter }})"/></section>
                        <section><span>YouTube URL:&nbsp;<input name="videoURL{{ forloop.counter }}" type="url"></span></section>
                        <input type="hidden" name="url_file{{ forloop.counter }}" id="url_file{{ forloop.counter }}" value="">
                    {% endfor %}
                </fieldset>

                <fieldset>
                    <div id="addQuestion-container">
                                <h2 id="test">Quiz</h2>
                                <h5 id="addQuestion" class="button green">Add Question </h5>
                            </div>
                        <br><br><br><br>

                        <div id="questions-container" style="display: flex; flex-direction: column;" >
                            {% for q in questions %}
                                    <div class="quest"  id="q{{ forloop.counter }}" style="order: {{ forloop.counter }};">
                                    <section>
                                        <label><strong>Position in the Quiz: </strong>
                                            <select name="order{{ forloop.counter }}" id="order{{ forloop.counter }}" onchange="applyPosition({{ forloop.counter }})">
                                                 <option {% if forloop.counter == 1 %} selected {% endif %} value=1>1</option>
                                                 <option {% if forloop.counter == 2 %} selected {% endif %} value=2>2</option>
                                                 <option {% if forloop.counter == 3 %} selected {% endif %} value=3>3</option>
                                                 <option {% if forloop.counter == 4 %} selected {% endif %} value=4>4</option>
                                                 <option {% if forloop.counter == 5 %} selected {% endif %} value=5>5</option>
                                                 <option {% if forloop.counter == 6 %} selected {% endif %} value=6>6</option>
                                                 <option {% if forloop.counter == 7 %} selected {% endif %} value=7>7</option>
                                                 <option {% if forloop.counter == 8 %} selected {% endif %} value=8>8</option>
                                                 <option {% if forloop.counter == 9 %} selected {% endif %} value=9>9</option>
                                                 <option {% if forloop.counter == 10 %} selected {% endif %} value=10>10</option>
                                            </select>
                                        </label>
                                    </section>
                                        <p>Question {{ forloop.counter }}: <textarea name="question{{ forloop.counter }}" rows="1"
                                                                                     cols="80"></textarea><span id="deleteq{{ forloop.counter }}" class="button red delete-box" style="text-indent: 10px;">Delete question</span></p>
                                        <div style="margin-left: 100px;">
                                            <p>Choices {{ forloop.counter }} (write the possible answers and select the correct one):</p>
                                            {% for c in choices %}
                                                <p>
                                                    <input type="radio" name="answer{{ forloop.parentloop.counter }}"
                                                           value="choice{{ forloop.parentloop.counter }}_{{ forloop.counter }}"
                                                           {% if forloop.counter == 1 %}checked {% endif %}>
                                                    <input type="text" name="choice{{ forloop.parentloop.counter }}_{{ forloop.counter }}">
                                                </p>
                                            {% endfor %}
                                        </div>
                                        <br>
                                        <p>Explanation {{ forloop.counter }}: <textarea name="explanation{{ forloop.counter }}" rows="1"
                                                                                     cols="100"></textarea></p>
                                        <br><br>

                                    </div>
                            {% endfor %}

                            <input type="hidden" id="idQuestions" name="idQuestions" value={{ nQuestions }}>
                        </div>


                </fieldset>

            <fieldset>

                <section>Do you want your micro-content to be visible?
                    <select name="visible">
                                    <option value="yes" selected>Yes</option>
                                    <option value="no"> No</option>
                    </select>
                </section>

                <section>Allow other users to copy your micro-content?
                    <select name="allow_copy">
                                    <option value="yes" selected>Yes</option>
                                    <option value="no">No</option>
                    </select>
                </section>

                <input type="hidden" id="author" name="author" value={{ user.username }}>
                <input type="hidden" id="creation_type" name="creation_type" value="own creation">
                <input class="button" type="submit" value="Create" style="background-color: green; margin: 0px 300px 100px 0px;">
            </fieldset>
            </div>
        </form>

    </div>

</body>
</html>