{% load static %}
<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Edit Micro Content</title>
      <link rel="stylesheet" type="text/css" href="{% static 'demo2.css' %}">
      <link rel="stylesheet" type="text/css" href="{% static 'sky-forms.css' %}">
    	<link rel="icon" type="image/png" href="{% static 'images/icons/book.png' %}"/>

</head>
<body class="bg-study">

<script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script>
         $(document).ready(function() {    //llamamos la a funcion ready() porque vamos a hacer referencia a etiquetas que estan declaradas posteriormente en el documento
                    document.getElementById("addQuestion").addEventListener("click", addQuestion, false);
                    var del = document.querySelectorAll("#questions-container span");
                      for (var i=0;i<del.length;i++) {
                          del[i].addEventListener("click",deleteQuestion, false);
                      }
         });
         function deleteQuestion(num) {

              var id = num.target.id;
              id = id.toString();
              i =  id[7];
              $("#q"+i).replaceWith("<span> </span>");

             // var index = id.substring(id.indexOf("q")+1, id.length());
          //   $("#q"+index+"-container").replaceWith("");


         }
         function addQuestion() {
                     $("#addQuestion-container h5").removeClass("animated bounce");
                     $("#addQuestion-container h5").addClass("animated bounce");
                     $("#idQuestions").attr('value',  parseInt($("#idQuestions").val()) + 1);

                    var id = $("#idQuestions").val();

                    $("#newQuestions-container").append("<div id=\"q"+id+"\" >");

                     $("#q"+id).append("<p>Question "+$("#idQuestions").val()+": <textarea name=\"question"+$("#idQuestions").val()+"\" rows=\"1\"\n" +
                         "                                                             cols=\"80\"></textarea><span id=\"deleteq"+$("#idQuestions").val()+"\" class=\"button red delete-box\" >Delete question </span></p></p>");
                     $("#q"+id).append("<p>Choices "+$("#idQuestions").val()+" (write the possible answers and select the correct one):</p>\n");

                     $("#q"+id).append("  {% for c in "   " %}\n"+
                         "                    <p>\n"+
                         "                        <input class=\"choice\" type=\"radio\" name=\"answer"+$("#idQuestions").val()+"\"\n"
                         +
                         "                               value=\"choice"+$("#idQuestions").val()+"_{{ forloop.counter }}\"\n"
                         +
                         "                               {% if forloop.counter == 1 %}checked {% endif %}>\n"+
                         "                        <input type=\"text\" name=\"choice"+$("#idQuestions").val()+"_{{ forloop.counter }}\">\n"
                         +
                         "                    </p>\n"+
                         "                {% endfor %}<br>");


                        $("#q"+id).append("<p>Explanation "+$("#idQuestions").val()+": <textarea name=\"explanation"+$("#idQuestions").val()+"\" rows=\"1\"\n" +
                                 "                                                                cols=\"100\"></textarea></p></div><br><br>");
                     document.getElementById("deleteq"+id).addEventListener("click", deleteQuestion, false);
         }
       </script>

    <div class="body">
        <h1>Micro-learning contents generator</h1>

        <form action="{% url 'micro_content_manager:update' %}" method="post" class="sky-form">

            {% csrf_token %}
            <div class="white">
                <h2>Content</h2>
                    <input type="hidden" name="id" value="{{ id }}">
                    <fieldset>
                        <section> <p>Title: <input type="text" name="title" value="{{ content.title }}" required></p></section>
                        <section> <p>Tags:<input type="text" name="mc_tags" value="{{mc_tags}}" required>
                          Tags must be inserted separated by blank spaces (e.g., Tag1 Tag2 Tag3)</p></section>

                         {% for p in content.text %}
                            <section><p>Paragraph {{ forloop.counter }}:<textarea name="paragraph{{ forloop.counter }}" rows="1"
                                                                         cols="100">{{ p }}</textarea></p></section>
                        {% endfor %}
                    </fieldset>

                    <fieldset>
                        <h2>Videos </h2>
                        {% for v in content.videos %}
                        <section>Video {{ forloop.counter }}</section>
                        <section>URL:<input name="videoURL{{ forloop.counter }}" type="url" value="{{ v.url }}" style="width: 500px;"></section>
                        <section>Format:<select name="videoFormat{{ forloop.counter }}">
                            <option value="mp4" {% if v.format == 'mp4' %} selected {% endif %}>mp4</option>
                            <option value="ogg" {% if v.format == 'ogg' %} selected {% endif %}>ogg</option>
                        </select></section>

                         <section>Upload form:<select name="video_upload_form{{ forloop.counter }}">
                            <option value="from_existing_file" {% if v.upload_form == 'from_existing_file' %} selected {% endif %}>From existing file</option>
                            <option value="link_from_youtube" {% if v.upload_form == 'link_from_youtube' %} selected {% endif %}>Link from YouTube</option>
                            <option value="download_from_youtube" {% if v.upload_form == 'download_from_youtube' %} selected {% endif %}>Download from Youtube</option>
                            <option value="external_repository" {% if v.upload_form == 'external_repository' %} selected {% endif %}>From external repository</option>
                        </select></section>
                        {% endfor %}
                    </fieldset>

                    <fieldset>

                                <div id="addQuestion-container">
                                    <h2>Quiz </h2>
                                    <h5 id="addQuestion" class="button green">Add Question</h5>
                                </div>
                                <br><br><br><br>


                            <div id="questions-container">
                                {% for q in content.questions.all %}


                                    <div id="q{{ forloop.counter }}">


                                        <p>Question {{ forloop.counter }}: <textarea name="question{{ forloop.counter }}" rows="1"
                                                                                     cols="100">{{ q.question }}</textarea><span id="deleteq{{ forloop.counter }}" class="button red delete-box">Delete question</span></p>

                                        <div style="margin-left: 100px;">
                                            Choices {{ forloop.counter }} (write the possible answers and select the correct one):<br>
                                           {% for choice in q.choices.all %}
                                                <input type="radio" name="answer{{ forloop.parentloop.counter }}"
                                                       value="choice{{ forloop.parentloop.counter }}_{{ forloop.counter }}"
                                                       {% if q.answer == choice.choice_text %}checked {% endif %}>
                                                <input type="text" name="choice{{ forloop.parentloop.counter }}_{{ forloop.counter }}" value={{ choice.choice_text }}>    <br>
                                           {% endfor %}
                                        </div>
                                        <br>
                                        <p>Explanation {{ forloop.counter }}: <textarea name="explanation{{ forloop.counter }}" rows="1"
                                                                                        cols="100">{{ q.explanation }}</textarea></p>
                                        <br><br>

                                    </div>
                                {% endfor %}
                            </div>
                                <input type="hidden" id="idQuestions" name="idQuestions" value={{ content.questions.count }}>
                                <div id="newQuestions-container">
                                </div>
                        <input class="button" type="submit" value="Save changes" style="background-color: green; margin: 0px 300px 100px 0px;">

                    </fieldset>
                 </div>
            </form>

    </div>
</body>
</html>